# Магазин на Django с интеграцией Stripe

Это простое Django-приложение с интеграцией Stripe, позволяющее:
- просматривать товары (`Item`).
- Создавать заказы (`Order`) из нескольких товаров с возможностью применения скидки (`Discount`) и налога (`Tax`).
- Оплачивать либо один товар, либо весь заказ сразу через `Stripe Payment Intent` или `Stripe Session`.

## Функциональность
**Модели**
- `Item` - название, описание, цена, валюта (usd или pln).
- `Discount` - код скидки и процент.
- `Tax` - название налога и процент.
- `Order` - множество товаров, опционально прикреплённые скидка/налог.

**Просмотр товара**
- URL - `/item/<item_id>/`.
- Отображается информация о товаре и кнопка "Buy".

**Оплата одного товара**
- При нажатии кнопки "Buy" на странице товара может происходить либо:
  - Перенаправление на `Stripe Checkout` (если используется `Stripe Session`).
  - Либо открываться встроенное меню с оплатой прямо на этой же странице (если используется `Stripe Payment Intent`).
- Для этого реализованы два метода:
  - `GET /buy/<item_id>/` - создаёт `tripe Checkout Session` и возвращает `{ "id": session_id }`.
  - `GET /item/<item_id>/intent/` - создаёт `Stripe Payment Intent` и возвращает `{ "client_secret": ... }`.

**Просмотр заказа**
- URL - `/order/<order_id>/`.
- Отображается список товаров заказа, показаны `subtotal`, `discount`, `tax` и итоговая сумма. Кнопка “Pay”.

**Оплата заказа**
- При нажатии кнопки "Buy" на странице заказа может происходить либо:
  - Перенаправление на `Stripe Checkout` (если используется `Stripe Session`).
  - Либо открываться встроенное меню с оплатой прямо на этой же странице (если используется `Stripe Payment Intent`).
- Для этого реализованы два метода:
  - `GET /order/<order_id>/create-checkout-session/` - создаёт `tripe Checkout Session` и
    возвращает `{ "id": session_id }`.
  - `GET /order/<order_id>/create-payment-intent/` - создаёт `Stripe Payment Intent` и
    возвращает `{ "client_secret": ... }`.

## Переменные окружения
Для корректной работы приложения необходимо задать следующие переменные окружения:
- `DJANGO_SECRET_KEY` - секретный ключ Django, используется для подписи сессий, CSRF и других криптографических операций.
- `DEBUG` - режим отладки (True или False).
- `ALLOWED_HOSTS` - список доменов или IP (через запятую), с которых разрешён доступ к приложению.
- `DJANGO_SUPERUSER_USERNAME` - имя суперпользователя, который будет автоматически создан.
- `DJANGO_SUPERUSER_PASSWORD` - пароль для этого суперпользователя.
- `DJANGO_SUPERUSER_EMAIL` - email суперпользователя.
- `STRIPE_SECRET_KEY` - секретный ключ Stripe (начинается на sk_test_…), необходим для серверной части операций с API.
- `STRIPE_PUBLISHABLE_KEY` - публичный ключ Stripe (начинается на pk_test_…), используется в JavaScript для инициализации Stripe.js.
- `STRIPE_USE_PAYMENT_INTENT` - флаг (True или False), определяющий, использовать ли Payment Intent (встроенная форма)
  вместо Checkout Session (редирект).
- `DATABASE_URL` - URL подключения к базе данных. Если не задана, локально приложение будет использовать SQLite (db.sqlite3).

